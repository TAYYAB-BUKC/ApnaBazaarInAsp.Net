
@{
	ViewBag.Title = "CategoryTable";
}

<link href="//cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<script src="//cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
<h2>CategoryTable</h2>

@model CategorySearchViewModel

<form>
	<div class="container">
		<div class="row">
			<div class="col-md-8">
				<input class="form-control" id="searchText" name="Search" placeholder="Search any Category here...." />
			</div>
			<div class="col-md-4">
				<div class="row">
					<div class="form-group"
					<div class="col-md-4 pr-0">
						<button type="button" id="searchBtn"> Search</button>
					</div>

					<div class="col-md-4 pr-0">
						<button type="button" id="resetBtn"> Reset</button>
					</div>

					<div class="col-md-4 pr-0">
						<button type="button" id="newBtn">New</button>
					</div>
				</div>
				</div>
			</div>

		</div>

	</div>

</form>



<table class="table table-striped">
	<thead>
		<tr>
			<th class="font-weight-bold">CategoryName</th>
			<th class="font-weight-bold">Description</th>
			<th class="font-weight-bold">Image</th>
			<th class="font-weight-bold">IsFeatured</th>
			<th class="font-weight-bold">Actions</th>
		</tr>
	</thead>
	<tbody>
		@foreach (var category in Model.Categories)
		{
			<tr>
				<td>@category.Name</td>


				<td>@category.Description</td>

				<td><img height="200px" width="200px" src="@category.Imagepath" alt="Cateogory Image" /></td>

				<td>@category.IsFeatured</td>

				<td>
					<button class="EditBtn" data-id="@category.ID">Edit</button>
					<button class="DeleteBtn" data-id="@category.ID">Delete</button>
				</td>

			</tr>
		}
	</tbody>

</table>

<div class="col-md-4">

	@if (Model.Pager != null && Model.Pager.TotalPages > 1)
	{
		if (Model.Pager.CurrentPage > 1)
		{
			<button type="button" class="PageRecords" data-pageNo="1">First</button>
			<button type="button" class="PageRecords" data-pageNo="@Model.Pager.CurrentPage - 1">Previous</button>
		}

		for (int page = Model.Pager.StartPage; page <= Model.Pager.EndPage; page++)
		{
			string activeClass = Model.Pager.CurrentPage == page ? "bg-info" : string.Empty;

			<button type="button" class="@activeClass PageRecords" data-pageNo="@page">@page</button>
		}

		if (Model.Pager.CurrentPage < Model.Pager.TotalPages)
		{
			<button type="button" class="PageRecords" data-pageNo="@Model.Pager.CurrentPage + 1">Next</button>
			<button type="button" class="PageRecords" data-pageNo="@Model.Pager.EndPage">Last</button>
		}
	}




</div>


<style>
	table, th, td {
		border: 2px solid black;
	}
</style>
<script>

	$(".PageRecords").click(function myfunction(){
			$.ajax({
				url: '@Url.Action("CategoriesTable","Category")', //'/Product/ProductTable',
				data: {
					pageNo: $(this).attr("data-pageNo"),
					search: '@Model.SearchTerm'
				}
		})
        .done(function (response) {
        	$("#tableContainer").html(response);
        })
        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
        	alert("Ajax Request Failed");
        });
		});

	$("#searchBtn").click(function myfunction() {
		var searchvalue = $("#searchText").val();
		$.ajax({
			//url: '/Category/CategoriesTable',
			url: '@Url.Action("CategoriesTable", "Category")',
			data:
			{
				search: searchvalue
			},
		})
        .done(function (response) {
        	$("#tableContainer").html(response);
        })
        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
        	alert("Ajax Request Failed");
        });
	});

	$("#resetBtn").click(function myfunction(){
		var searchvalue = '';
		$.ajax({
			url: '@Url.Action("CategoriesTable","Category")', // '/Category/CategoriesTable',
			data:
			{
				search: searchvalue
			},
		})
        .done(function (response) {
        	$("#tableContainer").html(response);
        })
        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
        	alert("Ajax Request Failed");
        });
	});


	$("#newBtn").click(function myfunction(){
		$.ajax({
			//url: '/Category/Create'
			url:'@Url.Action("Create","Category")',

		})
			.done(function (response) {
				$("#createCategory").html(response);
				focusAction("createCategory");
        })
        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
        	alert("Ajax Request Failed");
        });
	});

	$(".EditBtn").click(function myfunction() {
		$.ajax({
			//url: '/Category/Edit',
			url: '@Url.Action("Edit","Category")',
			data:
			{
					Id: $(this).attr("data-id")
			}
		})
			.done(function (response) {
				$("#createCategory").html(response);
				focusAction("createCategory");

			})
			.fail(function (XMLHttpRequest, textStatus, errorThrown) {
				alert("Ajax Request Failed");
			});
	});

	$(".DeleteBtn").click(function myfunction() {

		var confirmDelete = confirm("Are you sure you want to delete this category?");
		if (confirmDelete) {
		$.ajax({
			type: 'Post',
			//url: '/Category/Delete',
			url: '@Url.Action("Delete","Category")',
			data:
			{
					Id: $(this).attr("data-id")
			}
		})
			.done(function (response) {
				$("#tableContainer").html(response);

			})
			.fail(function (XMLHttpRequest, textStatus, errorThrown) {
				alert("Ajax Request Failed");
			});
		}
	});
</script>
