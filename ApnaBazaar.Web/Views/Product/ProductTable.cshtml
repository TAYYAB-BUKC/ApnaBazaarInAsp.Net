@model List<Product>	
@{
    ViewBag.Title = "ProductTable";
}

<h4>ProductTable</h4>


	<form>
		<div class="container">
			<div class="row">
				<div class="col-md-8">
					<input class="form-control" id="searchText" name="Search" placeholder="Search anything here...." />
				</div>
				<div class="col-md-4">
					<button type="button" id="searchBtn"> Search</button>
					<button type="button" id="newBtn">New</button>
				</div>

			</div>

		</div>
		
</form>



<table class="table table-striped">
	<thead>
		<tr>
			<td>ProductName</td>
			<td>Category</td>
			<td>Price</td>
			<td>Actions</td>
		</tr>
	</thead>	
	<tbody>
		@foreach (var product in Model)
		{
		<tr>
			<td>@product.Name</td>
			<td>
				@if (@product.Category != null)
				{
					<text>@product.Category.Name</text>
				}
				else
				{
					<text>-</text>
				}

			</td>
			<td>@product.Price</td>
			<td>
				<button class="EditBtn" data-id="@product.ID">Edit</button>
				<button class="DeleteBtn" data-id="@product.ID">Delete</button>
				<button class="AddToCart" data-id="@product.ID">AddToCart</button>
			</td>

		</tr>
		}
	</tbody>
	
</table>


<script>
	$("#searchBtn").click(function myfunction(){
		var searchvalue = $("#searchText").val();
		$.ajax({
			url: '/Product/ProductTable',
			data:
			{
				search: searchvalue
			},
		})
        .done(function (response) {
        	$("#tableContainer").html(response);
        })
        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
        	alert("Ajax Request Failed");
        });
	});


	$("#newBtn").click(function myfunction(){
		$.ajax({
			url: '/Product/Create'
		})
        .done(function (response) {
        	$("#createProduct").html(response);
        })
        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
        	alert("Ajax Request Failed");
        });
	});

	var products = [];
	$(".AddToCart").click(function myfunction() {

		var productID = $(this).attr("data-id");
		products.push(productID);

		$.cookie('CartProducts', products.join('-'), { path: '/' });
		alert("Product Added to Cart.");

	});
	$(".EditBtn").click(function myfunction() {
		$.ajax({
			url: '/Product/Edit',
			data:
			{
					Id: $(this).attr("data-id")
			}
		})
			.done(function (response) {
				$("#createProduct").html(response);

			})
			.fail(function (XMLHttpRequest, textStatus, errorThrown) {
				alert("Ajax Request Failed");
			});
	});

	$(".DeleteBtn").click(function myfunction() {

		swal({
			title: "Confirm?",
			text: "Are you sure you want to delete this product?",
			icon: "warning",
			 buttons: true,
			 dangerMode: true,
			})
		.then((willDelete) => {
			if (willDelete) {
				$.ajax({
					type: 'Post',
					url: '/Product/Delete',
					data:
					{
						Id: $(this).attr("data-id")
					}
				})
					.done(function (response) {
						swal("Poof! Your imaginary file has been deleted!", {
							icon: "success",
						});
						$("#tableContainer").html(response);


					})
					.fail(function (XMLHttpRequest, textStatus, errorThrown) {
						alert("Ajax Request Failed");
					});

			}
	});

		});
			  


/*
		var confirmDelete = confirm("Are you sure you want to delete this category?");
		if (confirmDelete) {
		$.ajax({
			type: 'Post',
			url: '/Product/Delete',
			data:
			{
					Id: $(this).attr("data-id")
			}
		})
			.done(function (response) {
				$("#tableContainer").html(response);

			})
			.fail(function (XMLHttpRequest, textStatus, errorThrown) {
				alert("Ajax Request Failed");
			});
		}
	});*/


</script>