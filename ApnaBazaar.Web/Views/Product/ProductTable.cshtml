@model ProductSearchViewModel	
@{
    ViewBag.Title = "ProductTable";
}

	@*<link href="//cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
	<script src="//cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>*@
	<form>
		<div class="container">
			<div class="row">
				<div class="col-md-4">
					<input class="form-control" id="searchText" name="Search" placeholder="Search anything here...." />
				</div>
				<div class="col-md-4 pr-0">
					<button type="button" id="searchBtn"> Search</button>
				</div>

				<div class="col-md-4 pr-0">
					<button type="button" id="resetBtn"> Reset</button>
				</div>

				<div class="col-md-4 pr-0">
					<button type="button" id="newBtn">New</button>
				</div>
			</div>

		</div>
		
</form>



<table id="ProductsTable" class="table table-striped">
	<thead>
		<tr>
			<th class="font-weight-bold">ProductName</th>
			<th class="font-weight-bold">Category</th>
			<th class="font-weight-bold">Price</th>
			<th class="font-weight-bold">Actions</th>
		</tr>
	</thead>	
	<tbody>
		@foreach (var product in Model.Products)
		{
		<tr>
			<td>@product.Name</td>
			<td>
				@if (@product.Category != null)
				{
					<text>@product.Category.Name</text>
				}
				else
				{
					<text>-</text>
				}

			</td>
			<td>@product.Price</td>
			<td>
				<button class="EditBtn" data-id="@product.ID">Edit</button>
				<button class="DeleteBtn" data-id="@product.ID">Delete</button>
				<button class="AddToCart" data-id="@product.ID">AddToCart</button>
			</td>

		</tr>
		}
	</tbody>
	
</table>
<div class="col-md-4">

	@if (Model.Pager != null && Model.Pager.TotalPages > 1)
	{
		if (Model.Pager.CurrentPage > 1)
		{
			<button type="button" class="PageRecords" data-pageNo="1">First</button>
			<button type="button" class="PageRecords" data-pageNo="@Model.Pager.CurrentPage - 1">Previous</button>
		}

		for (int page = Model.Pager.StartPage; page <= Model.Pager.EndPage; page++)
		{
			string activeClass = Model.Pager.CurrentPage == page ? "bg-info" : string.Empty;

			<button type="button" class="@activeClass PageRecords" data-pageNo="@page">@page</button>
		}

		if (Model.Pager.CurrentPage < Model.Pager.TotalPages)
		{
			<button type="button" class="PageRecords" data-pageNo="@Model.Pager.CurrentPage + 1">Next</button>
			<button type="button" class="PageRecords" data-pageNo="@Model.Pager.EndPage">Last</button>
		}
	}




</div>
<script>

	//$("#ProductsTable").DataTable();
		$(".PageRecords").click(function myfunction(){
			$.ajax({
				url: '@Url.Action("ProductTable","Product")', //'/Product/ProductTable',
				data: { pageNo: $(this).attr("data-pageNo"),
					search: '@Model.SearchTerm'
				}
			
		})
        .done(function (response) {
        	$("#tableContainer").html(response);
        })
        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
        	alert("Ajax Request Failed");
        });
		});

	$("#searchBtn").click(function myfunction(){
		var searchvalue = $("#searchText").val();
		$.ajax({
			url: '@Url.Action("ProductTable","Product")', // '/Product/ProductTable',
			data:
			{
				search: searchvalue
			},
		})
        .done(function (response) {
        	$("#tableContainer").html(response);
        })
        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
        	alert("Ajax Request Failed");
        });
	});


	$("#resetBtn").click(function myfunction(){
		var searchvalue = '';
		$.ajax({
			url: '@Url.Action("ProductTable","Product")', //'/Product/ProductTable',
			data:
			{
				search: searchvalue
			},
		})
        .done(function (response) {
        	$("#tableContainer").html(response);
        })
        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
        	alert("Ajax Request Failed");
        });
	});


	$("#newBtn").click(function myfunction(){
		$.ajax({
			url: '@Url.Action("Create","Product")'//'/Product/Create'
		})
        .done(function (response) {
			$("#createProduct").html(response);
			focusAction("createProduct");
        })
        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
        	alert("Ajax Request Failed");
        });
	});

	var products = [];
	$(".AddToCart").click(function myfunction() {

		var productID = $(this).attr("data-id");
		products.push(productID);

		$.cookie('CartProducts', products.join('-'), { path: '/' });
		alert("Product Added to Cart.");

	});
	$(".EditBtn").click(function myfunction() {
		$.ajax({
			url: '@Url.Action("Edit","Product")', //'/Product/Edit',
			data:
			{
					Id: $(this).attr("data-id")
			}
		})
			.done(function (response) {
				$("#createProduct").html(response);
				focusAction("createProduct");

			})
			.fail(function (XMLHttpRequest, textStatus, errorThrown) {
				alert("Ajax Request Failed");
			});
	});

	$(".DeleteBtn").click(function myfunction() {

		swal({
			title: "Confirm?",
			text: "Are you sure you want to delete this product?",
			icon: "warning",
			 buttons: true,
			 dangerMode: true,
			})
		.then((willDelete) => {
			if (willDelete) {
				$.ajax({
					type: 'Post',
					url: '@Url.Action("Delete","Product")',//'/Product/Delete',
					data:
					{
						Id: $(this).attr("data-id")
					}
				})
					.done(function (response) {
						swal("Poof! Your imaginary file has been deleted!", {
							icon: "success",
						});
						$("#tableContainer").html(response);


					})
					.fail(function (XMLHttpRequest, textStatus, errorThrown) {
						alert("Ajax Request Failed");
					});

			}
	});

		});
			  


/*
		var confirmDelete = confirm("Are you sure you want to delete this category?");
		if (confirmDelete) {
		$.ajax({
			type: 'Post',
			url: '/Product/Delete',
			data:
			{
					Id: $(this).attr("data-id")
			}
		})
			.done(function (response) {
				$("#tableContainer").html(response);

			})
			.fail(function (XMLHttpRequest, textStatus, errorThrown) {
				alert("Ajax Request Failed");
			});
		}
	});*/


</script>